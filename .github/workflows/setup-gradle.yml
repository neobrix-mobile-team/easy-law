name: üîß Í≥µÌÜµ Gradle ÌôòÍ≤Ω ÏÑ§Ï†ï

on:
  workflow_call:
    inputs:
      setup-api-keys:
        description: 'GEMINI_API_KEY, LAW_API_KEY ÏÑ§Ï†ï Ïó¨Î∂Ä'
        required: false
        type: boolean
        default: false
    secrets:
      GOOGLE_SERVICES_JSON:
        required: false
      GEMINI_API_KEY:
        required: false
      LAW_API_KEY:
        required: false

jobs:
  setup-environment:
    runs-on: ubuntu-latest
    name: ‚öôÔ∏è ÌôòÍ≤Ω ÏÑ§Ï†ï
    steps:
      - name: üì• ÏΩîÎìú Î∞õÏïÑÏò§Í∏∞
        uses: actions/checkout@v4

      - name: ‚òï JDK 17 ÏÑ§Ï†ï
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle
          cache-dependency-path: |
            **/gradle.properties
            **/build.gradle

      - name: üîß Gradle wrapper Í∂åÌïú ÏÑ§Ï†ï
        run: chmod +x ./gradlew

      - name: üìù local.properties ÏÉùÏÑ± (Í∏∞Î≥∏)
        run: |
          # Í∏∞Î≥∏ ÏÑ§Ï†ï
          touch local.properties
          echo "sdk.dir=$ANDROID_HOME" >> local.properties

      - name: üìù API ÌÇ§ Ï∂îÍ∞Ä (ÏÑ†ÌÉùÏ†Å)
        if: ${{ inputs.setup-api-keys == true }}
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          LAW_API_KEY: ${{ secrets.LAW_API_KEY }}
        run: |
          if [ -n "$GEMINI_API_KEY" ]; then
            echo "GEMINI_API_KEY=$GEMINI_API_KEY" >> local.properties
          else
            echo "‚ö†Ô∏è GEMINI_API_KEY secret is missing!"
          fi
          
          if [ -n "$LAW_API_KEY" ]; then
            echo "LAW_API_KEY=$LAW_API_KEY" >> local.properties
          else
            echo "‚ö†Ô∏è LAW_API_KEY secret is missing!"
          fi

      - name: üî• google-services.json ÏÉùÏÑ±
        if: ${{ secrets.GOOGLE_SERVICES_JSON != '' }}
        env:
          G_SERVICES: ${{ secrets.GOOGLE_SERVICES_JSON }}
        run: |
          echo "$G_SERVICES" | base64 -d > app/google-services.json
          echo "‚úÖ google-services.json created successfully"

      - name: ‚ö†Ô∏è Google Services Í≤ΩÍ≥†
        if: ${{ secrets.GOOGLE_SERVICES_JSON == '' }}
        run: |
          echo "‚ö†Ô∏è GOOGLE_SERVICES_JSON secret is not configured!"
          echo "This may cause build failures if the app requires Firebase."

