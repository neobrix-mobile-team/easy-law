name: ğŸ” ì½”ë“œ í’ˆì§ˆ & ë³´ì•ˆ ê²€ì‚¬

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  lint:
    name: ğŸ” Android Lint í’ˆì§ˆ ê²€ì‚¬
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ë°›ì•„ì˜¤ê¸°
      uses: actions/checkout@v3
    
    - name: â˜• JDK 17 ì„¤ì •
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
    
    - name: ğŸ”§ Gradle wrapper ê¶Œí•œ ì„¤ì •
      run: chmod +x ./gradlew
    
    - name: ğŸ” Android Lintë¡œ ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
      run: |
        echo "ğŸ” ë‹¤ìŒì„ ê²€ì‚¬í•©ë‹ˆë‹¤:"
        echo "  âœ“ ë³´ì•ˆ ì·¨ì•½ì  (Security Issues)"
        echo "  âœ“ ì„±ëŠ¥ ë¬¸ì œ (Performance Issues)"
        echo "  âœ“ ì ‘ê·¼ì„± ë¬¸ì œ (Accessibility Issues)"
        echo "  âœ“ ë ˆì´ì•„ì›ƒ ë¬¸ì œ (Layout Issues)"
        echo ""
        ./gradlew lint --info || true
        echo "âœ… Lint ê²€ì‚¬ ì™„ë£Œ"
    
    - name: ğŸ“¤ Lint ê²°ê³¼ ì—…ë¡œë“œ
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: lint-report
        path: |
          app/build/reports/lint-results*.html
          app/build/reports/lint-results*.xml
        retention-days: 7

  security-scan:
    name: ğŸ”’ ì˜ì¡´ì„± ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬ (OWASP)
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ë°›ì•„ì˜¤ê¸°
      uses: actions/checkout@v3
    
    - name: â˜• JDK 17 ì„¤ì •
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
    
    - name: ğŸ”§ Gradle wrapper ê¶Œí•œ ì„¤ì •
      run: chmod +x ./gradlew
    
    - name: ğŸ”’ OWASP Dependency Checkë¡œ ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬
      run: |
        echo "ğŸ›¡ï¸ ë‹¤ìŒì„ ê²€ì‚¬í•©ë‹ˆë‹¤:"
        echo "  âœ“ ì˜ì¡´ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì•Œë ¤ì§„ ë³´ì•ˆ ì·¨ì•½ì "
        echo "  âœ“ CVE (Common Vulnerabilities and Exposures)"
        echo "  âœ“ ì˜¤ë˜ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „"
        echo ""
        ./gradlew dependencyCheckAnalyze --info || true
        echo "âœ… ë³´ì•ˆ ê²€ì‚¬ ì™„ë£Œ"
    
    - name: ğŸ“¤ ë³´ì•ˆ ê²€ì‚¬ ê²°ê³¼ ì—…ë¡œë“œ
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: security-scan-report
        path: |
          build/reports/dependency-check/
        retention-days: 7

  coverage:
    name: ğŸ“Š ì½”ë“œ ì»¤ë²„ë¦¬ì§€ (Jacoco)
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ë°›ì•„ì˜¤ê¸°
      uses: actions/checkout@v3
    
    - name: â˜• JDK 17 ì„¤ì •
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
    
    - name: ğŸ”§ Gradle wrapper ê¶Œí•œ ì„¤ì •
      run: chmod +x ./gradlew
    
    - name: ğŸ§ª ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      run: |
        echo "ğŸ§¬ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤..."
        ./gradlew testDebugUnitTest --info || true
    
    - name: ğŸ“Š ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ìƒì„±
      run: |
        echo "ğŸ“ˆ Jacocoìœ¼ë¡œ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤..."
        echo "ëª©í‘œ: 70% ì´ìƒì˜ ì»¤ë²„ë¦¬ì§€ ë‹¬ì„±"
        echo ""
        ./gradlew jacocoTestDebugUnitTestReport --info || true
        echo "âœ… ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ"
    
    - name: ğŸ“¤ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ì—…ë¡œë“œ
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: coverage-report
        path: |
          app/build/reports/coverage/debugCodeCoverage/
          app/build/jacoco/
        retention-days: 7
    
    - name: ğŸ“Š ì»¤ë²„ë¦¬ì§€ ìš”ì•½
      if: always()
      run: |
        echo "ğŸ“ˆ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ:"
        echo "  âœ“ ViewModel: 70%+"
        echo "  âœ“ Repository: 70%+"
        echo "  âœ“ UseCase: 70%+"
        echo "  âœ“ ì „ì²´: 70%+"
        echo ""
        if [ -f "app/build/reports/coverage/debugCodeCoverage/index.html" ]; then
          echo "âœ… ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"
        else
          echo "âš ï¸ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (gradle ì„¤ì • í™•ì¸ í•„ìš”)"
        fi
