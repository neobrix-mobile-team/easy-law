name: üè∑Ô∏è Auto Label PR

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  add-labels:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read

    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: üìä PR Î∂ÑÏÑù Î∞è ÎùºÎ≤® Ï∂îÍ∞Ä
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const { execSync } = require('child_process');

            // PR Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
            const pr = context.payload.pull_request;
            const labelsToAdd = [];

            // Î≥ÄÍ≤ΩÎêú ÌååÏùº Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
            const { data: files } = await github.rest.pulls.listFiles({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: pr.number,
            });

            const changedFiles = files.map(f => f.filename);

            console.log('üìù Changed files:');
            changedFiles.forEach(file => console.log(`  - ${file}`));

            // ÌååÏùº Í≤ΩÎ°ú Í∏∞Î∞ò ÎùºÎ≤® Í≤∞Ï†ï
            if (changedFiles.some(f => f.includes('app/build.gradle'))) {
              labelsToAdd.push('üîß build');
            }

            if (changedFiles.some(f => f.includes('.github/workflows'))) {
              labelsToAdd.push('üîÑ CI/CD');
            }

            if (changedFiles.some(f => f.includes('app/src/main/java/com/easylaw/app/ui/'))) {
              labelsToAdd.push('üé® UI');
            }

            if (changedFiles.some(f => f.includes('app/src/main/java/com/easylaw/app/viewmodel/'))) {
              labelsToAdd.push('‚öôÔ∏è ViewModel');
            }

            if (changedFiles.some(f => f.includes('app/src/main/java/com/easylaw/app/domain/'))) {
              labelsToAdd.push('üì¶ Domain');
            }

            if (changedFiles.some(f => f.includes('app/src/main/java/com/easylaw/app/repository/'))) {
              labelsToAdd.push('üóÑÔ∏è Repository');
            }

            if (changedFiles.some(f => f.includes('app/src/main/java/com/easylaw/app/util/'))) {
              labelsToAdd.push('üõ†Ô∏è Utility');
            }

            if (changedFiles.some(f => f.includes('app/src/test/') || f.includes('app/src/androidTest/'))) {
              labelsToAdd.push('‚úÖ Test');
            }

            if (changedFiles.some(f => f.includes('README') || f.includes('CONTRIBUTING') || f.includes('DEVELOPMENT'))) {
              labelsToAdd.push('üìö Documentation');
            }

            // PR Ï†úÎ™©ÏúºÎ°ú Ï∂îÍ∞Ä ÎùºÎ≤® Í≤∞Ï†ï
            const title = pr.title.toLowerCase();

            if (title.includes('fix:') || title.includes('hotfix')) {
              labelsToAdd.push('üêõ bug');
            }

            if (title.includes('feat:') || title.includes('feature')) {
              labelsToAdd.push('‚ú® feature');
            }

            if (title.includes('refactor:') || title.includes('refactoring')) {
              labelsToAdd.push('‚ôªÔ∏è refactor');
            }

            if (title.includes('docs:') || title.includes('documentation')) {
              labelsToAdd.push('üìö Documentation');
            }

            if (title.includes('chore:') || title.includes('maintenance')) {
              labelsToAdd.push('üßπ chore');
            }

            if (title.includes('style:') || title.includes('format')) {
              labelsToAdd.push('üíÖ style');
            }

            if (title.includes('perf:') || title.includes('performance')) {
              labelsToAdd.push('‚ö° performance');
            }

            // Ï§ëÎ≥µ Ï†úÍ±∞
            const uniqueLabels = [...new Set(labelsToAdd)];

            if (uniqueLabels.length > 0) {
              console.log('\nüè∑Ô∏è Adding labels:');
              uniqueLabels.forEach(label => console.log(`  - ${label}`));

              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.number,
                labels: uniqueLabels,
              });

              console.log('\n‚úÖ Labels added successfully!');
            } else {
              console.log('\n‚ö†Ô∏è No labels to add');
            }

